<html>
  <head>
    <style>
      .game {
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
      }
      .hand-container {
        height: 160px;
        display: flex;
        justify-content: space-around;
        width: 100%;
      }
      .player-hand.active {
        background: #eee;
      }
      .play-container {
        display: flex;
        justify-content: center;
        align-items: center;
      }
      .play-side {
        display: flex;
        flex-wrap: wrap;
        min-width: 620px;
        max-width: 620px;
      }
      .play-side.active {
        background: #eee;
      }
      #team-2 {
        justify-content: end;
      }
      .gap {
        display: flex;
        flex-direction: column;
        align-items: center;
        max-width: 120px;
      }
      .card {
        position: relative;
        width: 100px;
        height: 140px;
        margin: 8px;
        border: solid 5px #ccc;
        display: inline-flex;
        justify-content: center;
        align-items: center;
        user-select: none;
        font-size: 60px;
        box-sizing: border-box;
      }
      .card.active {
        border-color: #3157d5
      }
      .card.valid {
        border-color: #31d589
      }
      .card.invalid {
        border-color: #f04a38;
      }
      .point-value {
        position: absolute;
        bottom: 8px;
        right: 8px;
        font-size: 16px;
      }
    </style>
  </head>
  <body>
    <label>Number of players:</label><input value=4 type="number" id="number-of-players" />
    <label>Number of cards in hand:</label><input value=3 type="number" id="number-of-cards-in-hand" />
    <div class="game">
      <div class="hand-container top"></div>
      <div class="play-container">
        <div id="team-1" class="play-side active">
          <div class="card board"><div class="letter"></div><div class="point-value"></div></div>
          <div class="card board"><div class="letter"></div><div class="point-value"></div></div>
          <div class="card board"><div class="letter"></div><div class="point-value"></div></div>
          <div class="card board"><div class="letter"></div><div class="point-value"></div></div>
          <div class="card board"><div class="letter"></div><div class="point-value"></div></div>
          <div class="card board"><div class="letter"></div><div class="point-value"></div></div>
          <div class="card board"><div class="letter"></div><div class="point-value"></div></div>
          <div class="card board"><div class="letter"></div><div class="point-value"></div></div>
          <div class="card board"><div class="letter"></div><div class="point-value"></div></div>
          <div class="card board"><div class="letter"></div><div class="point-value"></div></div>
          <div class="card board"><div class="letter"></div><div class="point-value"></div></div>
          <div class="card board"><div class="letter"></div><div class="point-value"></div></div>
          <div class="card board"><div class="letter"></div><div class="point-value"></div></div>
          <div class="card board"><div class="letter"></div><div class="point-value"></div></div>
          <div class="card board"><div class="letter"></div><div class="point-value"></div></div>
        </div>
        <div class="gap">
          <h1 id="valid-word"></h1>
          <p id="valid-word-definition"></p>
        </div>
        <div id="team-2" class="play-side">
          <div class="card board"><div class="letter"></div><div class="point-value"></div></div>
          <div class="card board"><div class="letter"></div><div class="point-value"></div></div>
          <div class="card board"><div class="letter"></div><div class="point-value"></div></div>
          <div class="card board"><div class="letter"></div><div class="point-value"></div></div>
          <div class="card board"><div class="letter"></div><div class="point-value"></div></div>
          <div class="card board"><div class="letter"></div><div class="point-value"></div></div>
          <div class="card board"><div class="letter"></div><div class="point-value"></div></div>
          <div class="card board"><div class="letter"></div><div class="point-value"></div></div>
          <div class="card board"><div class="letter"></div><div class="point-value"></div></div>
          <div class="card board"><div class="letter"></div><div class="point-value"></div></div>
          <div class="card board"><div class="letter"></div><div class="point-value"></div></div>
          <div class="card board"><div class="letter"></div><div class="point-value"></div></div>
          <div class="card board"><div class="letter"></div><div class="point-value"></div></div>
          <div class="card board"><div class="letter"></div><div class="point-value"></div></div>
          <div class="card board"><div class="letter"></div><div class="point-value"></div></div>
        </div>
      </div>
      <div class="hand-container bottom"></div>
    </div>
  </body>
  <script>
    window.onload = () => {
      playSides = Array.from(document.getElementsByClassName('play-side'))
      boardCards = Array.from(document.getElementsByClassName('card board'))
      handContainerElements = Array.from(document.getElementsByClassName('hand-container'))
      validWordElement = document.getElementById('valid-word')
      validWordDefinitionElement = document.getElementById('valid-word-definition')
      numberOfPlayersInput = document.getElementById('number-of-players')
      numberOfCardsInHandInput = document.getElementById('number-of-cards-in-hand')
      numberOfPlayers = 4
      numberOfTeams = 2
      numberOfCardsInHand = 3
      activePlayer = 0
      activeTeam = 0
      validWord = ''
      validWordDefinition = ''
      LETTERS = [
        { letter: 'A', frequency: 85 },
        { letter: 'B', frequency: 27 },
        { letter: 'C', frequency: 49 },
        { letter: 'D', frequency: 33 },
        { letter: 'E', frequency: 109 },
        { letter: 'F', frequency: 18 },
        { letter: 'G', frequency: 26 },
        { letter: 'H', frequency: 39 },
        { letter: 'I', frequency: 55 },
        { letter: 'J', frequency: 2 },
        { letter: 'K', frequency: 14 },
        { letter: 'L', frequency: 62 },
        { letter: 'M', frequency: 28 },
        { letter: 'N', frequency: 51 },
        { letter: 'O', frequency: 72 },
        { letter: 'P', frequency: 26 },
        { letter: 'Q', frequency: 2 },
        { letter: 'R', frequency: 84 },
        { letter: 'S', frequency: 59 },
        { letter: 'T', frequency: 67 },
        { letter: 'U', frequency: 34 },
        { letter: 'V', frequency: 11 },
        { letter: 'W', frequency: 14 },
        { letter: 'X', frequency: 2 },
        { letter: 'Y', frequency: 26 },
        { letter: 'Z', frequency: 2 }
      ]
      frequencySum = 0
      frequencyMax = 0
      const httpGet = (url) => {
        var xmlHttp = new XMLHttpRequest();
        xmlHttp.open("GET", url, false);
        xmlHttp.send(null);
        return xmlHttp.responseText;
      }
      const setupHands = () => {
        handContainerElements.forEach(e => {
          e.innerHTML = null
        })
        boardCards.forEach(c => {
          Array.from(c.children).forEach(c => {
            c.innerHTML = null
          })
        })
        for (let i = 0; i < numberOfPlayers; i++) {
          handElement = document.createElement('div')
          handElement.classList.add('player-hand')
          if (i === 0) {
            handElement.classList.add('active')
          }
          for (let j = 0; j < numberOfCardsInHand; j++) {
            handCardElement = document.createElement('div')
            handCardElement.classList.add('card', 'hand')
            letterElement = document.createElement('div')
            letterElement.classList.add('letter')
            pointValueElement = document.createElement('div')
            pointValueElement.classList.add('point-value')
            handCardElement.appendChild(letterElement)
            handCardElement.appendChild(pointValueElement)
            handElement.appendChild(handCardElement)
          }
          nthHandContainer = (i % 2) ? 1 : 0
          document.getElementsByClassName('hand-container')[nthHandContainer].appendChild(handElement)
        }
      }
      numberOfPlayersInput.addEventListener('change', e => {
        numberOfPlayers = e.target.value
        resetBoard()
      })
      numberOfCardsInHandInput.addEventListener('change', e => {
        numberOfCardsInHand = e.target.value
        resetBoard()
      })
      const calculatePointValues = () => {
        LETTERS.forEach(char => {
          frequencySum += char.frequency
          if (char.frequency > frequencyMax) {
            frequencyMax = char.frequency
          }
          char.point_value = Math.max(1, Math.ceil((frequencyMax - char.frequency) / 10 + 1) - 2)
        })
      }
      const incrementTurn = () => {
        activePlayer = (activePlayer + 1) % numberOfPlayers
        activeTeam = (activeTeam + 1) % numberOfTeams

        activeTeamElement = document.getElementById(activeTeam ? 'team-2' : 'team-1')
        inactiveTeamElement = document.getElementById(activeTeam ? 'team-1' : 'team-2')
        activeTeamElement.classList.add('active')
        inactiveTeamElement.classList.remove('active')

        activePlayerElement = document.getElementsByClassName('player-hand active')[0]
        nextPlayerElement = document.getElementsByClassName('player-hand')[activePlayer]
        activePlayerElement.classList.remove('active')
        nextPlayerElement.classList.add('active')
      }
      const chooseRandomLetter = (card) => {
        randomIndex = Math.ceil(Math.random() * frequencySum)
        tempSum = 0
        letter = false
        LETTERS.forEach(l => {
          tempSum += l.frequency
          if (tempSum >= randomIndex && !letter) {
            letter = l
          }
        })

        card.classList.remove('active')
        card.children[0].innerHTML = letter.letter
        card.children[1].innerHTML = letter.point_value
      }
      const placeCard = (boardCard, handCard) => {
        boardCard.innerHTML = handCard.innerHTML
        chooseRandomLetter(handCard)
        incrementTurn()
      }
      const getRowText = (card) => {
        index = Array.from(card.parentNode.children).indexOf(card)
        row = Math.floor(index / 5)
        rowElements = Array.from(card.parentNode.children).slice(row * 5, row * 5 + 5)
        rowText = ''
        rowElements.forEach(el => {
          rowText = rowText.concat(el.children[0].innerHTML)
        })

        return {
          word: rowText,
          rowElements
        }
      }
      const checkWordValidity = (word) => {
        response = JSON.parse(httpGet(`https://dictionaryapi.com/api/v3/references/collegiate/json/${word}?key=f9144e92-9061-4ab5-b46d-f4d37b23f330`))
        isValid = typeof response[0] === 'object'
        validWordDefinition = isValid ? response[0].shortdef[0] : ''

        return isValid
      }
      const setRowValidity = (rowElements, isValid) => {
        rowElements.forEach(el => {
          el.classList.add(isValid ? 'valid' : 'invalid')
          el.classList.remove(isValid ? 'invalid' : 'valid')
        })
      }
      const setDefinition = (word) => {
        validWordElement.innerHTML = word
        validWordDefinitionElement.innerHTML = validWordDefinition
      }

      calculatePointValues()
      const resetBoard = () => {
        setupHands()
        handCards = Array.from(document.getElementsByClassName('card hand'))
        boardCards = Array.from(document.getElementsByClassName('card board'))
        handCards.forEach(card => {
          chooseRandomLetter(card)
          card.onclick = () => {
            if (card.parentNode.classList.contains('active')) {
              Array.from(card.parentNode.children).forEach(c => {
                c.classList.remove('active')
              })
              card.classList.add('active')
            }
          }
        })
        boardCards.forEach(card => {
          card.onclick = () => {
            isCorrectTurn = card.parentNode.classList.contains('active')
            selectedHandCard = document.getElementsByClassName('card hand active')[0]
            if (isCorrectTurn && selectedHandCard) {
              placeCard(card, selectedHandCard)
              const { word, rowElements } = getRowText(card)

              if (word.length === 5) {
                isValid = checkWordValidity(word)
                setRowValidity(rowElements, isValid)

                if (isValid) {
                  setDefinition(word)
                }
              }
            }
          }
        })  

        activePlayer = 0
        activeTeam = 0
        playSides[0].classList.add('active')
        playSides[1].classList.remove('active')
      }
      resetBoard()
    }
  </script>
</html>